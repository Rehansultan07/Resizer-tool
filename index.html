<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Photo Editor - Resize & Name/Date</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e293b; --accent: #3b82f6; --success: #059669; --danger: #ef4444; }
        body { font-family: 'Poppins', sans-serif; background-color: #f3f4f6; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        .navbar { background: var(--primary); color: white; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; }
        .nav-brand h1 { font-size: 20px; margin: 0; text-transform: uppercase; }
        .main-container { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .editor-card { background: white; width: 100%; max-width: 1200px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: flex; flex-direction: row; overflow: hidden; }
        .controls-panel { padding: 20px; width: 350px; border-right: 1px solid #e5e7eb; overflow-y: auto; max-height: 85vh; }
        .editor-panel { flex: 1; background: #cbd5e1; display: flex; justify-content: center; align-items: center; padding: 20px; min-height: 500px; }
        .canvas-container { box-shadow: 0 20px 50px rgba(0,0,0,0.3); border: 8px solid white; background: white; }
        .control-group { margin-bottom: 15px; background: #f8fafc; padding: 10px; border-radius: 8px; }
        .btn-upload { border: 2px dashed var(--accent); color: var(--accent); background: #eff6ff; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
        .btn-download { background: var(--success); color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .ad-space { width: 100%; max-width: 1200px; min-height: 90px; margin: 15px 0; border-radius: 8px; overflow: hidden; text-align: center; }
        @media (max-width: 768px) { .editor-card { flex-direction: column; } .controls-panel { width: 100%; } }
    </style>
</head>
<body>

<div class="navbar">
    <div class="nav-brand"><h1>PRO EDITOR</h1></div>
</div>

<div class="main-container">
    <div id="topAd" class="ad-space"></div>

    <div class="editor-card">
        <div class="controls-panel">
            <div class="upload-btn-wrapper">
                <button class="btn-upload">Upload Photo</button>
                <input type="file" id="imageInput" accept="image/*" style="position:absolute; left:0; top:0; opacity:0; width:100%; height:100%; cursor:pointer;">
            </div>
            <div class="control-group">
                <label style="font-size:12px; font-weight:700;">Name & Date</label>
                <input type="text" id="userName" placeholder="Full Name" style="width:100%; margin:5px 0; padding:8px;" oninput="render()">
                <input type="text" id="userDate" placeholder="Date" style="width:100%; padding:8px;" oninput="render()">
            </div>
            <div class="control-group">
                <label>Zoom & Brightness</label>
                <input type="range" id="zoomSlider" min="0.1" max="2.5" step="0.01" value="1" style="width:100%;" oninput="render()">
                <input type="range" id="brightSlider" min="50" max="150" value="100" style="width:100%;" oninput="render()">
            </div>
            <div class="control-group" style="background:#fff7ed;">
                <label>Quality (KB)</label>
                <input type="range" id="qualitySlider" min="0.1" max="1.0" step="0.01" value="0.8" style="width:100%;" oninput="render()">
                <div id="sizeEstimate" style="font-weight:700; text-align:center; margin-top:5px;">- KB</div>
            </div>
            <button id="downloadBtn" class="btn-download" disabled>Download JPG</button>
        </div>
        <div class="editor-panel">
            <div class="canvas-container">
                <canvas id="editorCanvas" width="350" height="450"></canvas>
            </div>
        </div>
    </div>

    <div id="botAd" class="ad-space"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Update with your config
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "photo-resizer-e8230.firebaseapp.com",
        projectId: "photo-resizer-e8230",
        databaseURL: "https://photo-resizer-e8230-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Dynamic Ads Loader
    onValue(ref(db, 'tool_ads'), (snapshot) => {
        const ads = snapshot.val();
        if(ads) {
            if(ads.top.img) document.getElementById('topAd').innerHTML = `<a href="${ads.top.url}" target="_blank"><img src="${ads.top.img}" style="max-width:100%;"></a>`;
            if(ads.bot.img) document.getElementById('botAd').innerHTML = `<a href="${ads.bot.url}" target="_blank"><img src="${ads.bot.img}" style="max-width:100%;"></a>`;
        }
    });

    // Editor Logic
    const canvas = document.getElementById('editorCanvas');
    const ctx = canvas.getContext('2d');
    let img = new Image(); let isLoaded = false;

    document.getElementById('imageInput').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => { img.onload = () => { isLoaded = true; render(); }; img.src = ev.target.result; };
        reader.readAsDataURL(e.target.files[0]);
    };

    window.render = () => {
        if(!isLoaded) return;
        ctx.fillStyle = "white"; ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width/2, (canvas.height-60)/2);
        ctx.scale(document.getElementById('zoomSlider').value, document.getElementById('zoomSlider').value);
        ctx.filter = `brightness(${document.getElementById('brightSlider').value}%)`;
        ctx.drawImage(img, -img.width/2, -img.height/2);
        ctx.restore();

        if(document.getElementById('userName').value) {
            ctx.fillStyle = "white"; ctx.fillRect(0, canvas.height-70, canvas.width, 70);
            ctx.fillStyle = "black"; ctx.font = "bold 16px Arial"; ctx.textAlign="center";
            ctx.fillText(document.getElementById('userName').value.toUpperCase(), canvas.width/2, canvas.height-40);
            ctx.fillText(document.getElementById('userDate').value, canvas.width/2, canvas.height-15);
        }
        updateSize();
    };

    function updateSize() {
        const dataUrl = canvas.toDataURL('image/jpeg', parseFloat(document.getElementById('qualitySlider').value));
        const kb = Math.round((dataUrl.length - 22) * 0.75) / 1024;
        document.getElementById('sizeEstimate').innerText = kb.toFixed(2) + " KB";
        document.getElementById('downloadBtn').disabled = (kb < 10 || kb > 3072);
        document.getElementById('downloadBtn').onclick = () => {
            const a = document.createElement('a'); a.download = "Photo.jpg"; a.href = dataUrl; a.click();
        };
    }
</script>
</body>
</html>
